## Function-Based Views

### 登录

分发token:D
创建钱包:D

### 统一支付(lock)

创建订单,返回订单号

### 提现

完整性校验

## Class-Based Views

### 

### PocketMoney

#### create


付款订单查询:D

扣除服务费:D

金额除于个数小于0.1元设置不成功:D

创建红包:D

设置过期时间:D

生成海报

#### retrieve

屏蔽未激活红包

#### list

user == request.user

#### delete

status = 0

### Answer

#### create

调用语音识别,语音转文字(再转拼音) :D

解耦识别模块:D

语音匹配:D

正确 随机分发金额:D

错误 不通过:D

#### list

我收到的红包

### TextTemplate

#### create

敏感词检查:D

### pick

随机获取:D

### list

展开列表

## 异步任务

### 5分钟检查过期红包:D

### 敏感词常驻内存缓存:D


## 创建红包流程:

创建: text, amount, num

红包状态: 

- 1 进行中 
- 0 未激活(支付错误) 
- -1 已过期 
- -2 被举报

## 支付流程

先创建红包,未激活

待统一支付接口,request包含pm_id,服务端生成payrecord,返回param

客户端发起支付,等待数秒,成功跳转.

服务端等待微信回调

得到回调:更新payrecord,更新pm激活状态

## 交易记录

### 对象: 用户微信,商户,红包,钱包

充值: 微信 --> 红包

提现: 钱包 --> 微信

回答: 红包 --> 钱包

## 用户详情页:

发出的:

金额/个数 -- 红包列表

收到的:

金额/个数 -- 回答列表 

